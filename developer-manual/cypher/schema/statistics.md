### 3.5.3. 통계

Cypher쿼리를 실행하면, 질문을 실행하고 답변 할 수있는 실행 계획 ([3.7. "실행 계획"]() 참고)으로 컴파일됩니다.
Neo4j는 쿼리와 관련된 효율적인 계획을 수립하기 위해 스키마와 같은 데이터베이스에 대한 정보가 필요합니다. 인덱스와 제약 조건은 무엇입니까? 또한 Neo4j는 실행 계획을 최적화하기 위해 데이터베이스에 대해 유지할 수 있는 통계 정보를 사용합니다. 이 정보를 통해 Neo4j는 어떤 액세스 패턴이 최고의 수행력을 발휘할지 결정할 수 있습니다.

Neo4j가 유지할 수 있는 통계 정보는 다음과 같습니다.

1. 특정 레이블이 있는 노드의 수
2. 인덱스 당 선택성.
3. 유형별 관계의 수.
4. 특정 레이블이 있는 노드에서 유형, 종료 또는 시작하는 관계의 수

Neo4j는 두 가지 다른 방법으로 통계를 최신 상태로 유지합니다. 예를 들어, 레이블 수의 경우 노드에서 레이블을 설정하거나 제거 할 때마다 번호가 업데이트됩니다. 인덱스의 경우, 선택도 번호를 생성하려면 Neo4j가 전체 인덱스를 스캔해야합니다. 이것은 잠재적으로 매우 시간이 많이 걸리는 작업이기 때문에 인덱스의 충분한 데이터가 변경되면 백그라운드에서 이러한 수치가 수집됩니다.

#### 3.5.3.1. 구성 옵션

실행 계획은 캐시되며 계획을 생성하는데 사용된 통계 정보가 변경 될 때까지 다시 계획되지 않습니다. 다음 구성 옵션을 사용하면 데이터베이스의 업데이트에 대한 중요한 재구성이 수행되는 방식을 제어 할 수 있습니다.

**dbms.index_sampling.background_enabled**
인덱스가 충분히 업데이트되었을 때 인덱스를 자동으로 다시 샘플링할지 여부를 제어합니다. Cypher 쿼리 실행기(Query Planner)는 정확한 통계를 기반으로 효율적인 계획을 세우므로 데이터베이스가 발전함에 따라 최신 상태로 유지하는 것이 중요합니다.

배경 샘플링이 꺼져있는 경우, 데이터가 업데이트되면 수동 샘플링을 트리거(trigger) 하십시오.

**dbms.index_sampling.update_percentage**
새 샘플링 실행이 트리거(trigger)되기 전에 인덱스의 많은 부분이 업데이트 되어야하는 정도를 제어합니다.

**cypher.statistics_divergence_threshold**
실행 계획이 오래된 것으로 간주되어 다시 계획되어야하기 전에 위의 통계 정보가 변경되는 정도를 제어합니다. 통계 중 상대적인 변화가이 임계 값보다 크면 계획이 폐기되고 새 계획이 작성됩니다. 임계 값 0.0은 항상 replan을 의미하고 값 1.0은 결코 replan을 의미하지 않습니다.

#### 3.5.3.2. 수동 인덱스 샘플링
인덱스 리샘플링은 db.resampleIndex () 및 db.resampleOutdatedIndexes ()라는 두 개의 내장 프로시저(built-in procedure)를 사용하여 트리거(trigger) 할 수 있습니다.

다음은 리샘플링을 트리거(trigger)하기 위해 Cypher-Shell을 사용하는 예입니다.
```Javascript
> cypher-shell 'CALL db.resampleIndex(":Person(name)");'
> cypher-shell 'CALL db.resampleOutdatedIndexes();'
```
